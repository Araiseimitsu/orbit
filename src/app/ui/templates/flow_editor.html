{% extends "base.html" %}

{% block title %}{{ page_title }} - ORBIT{% endblock %}

{% block head %}
    <link rel="stylesheet" href="/static/flow-editor.css?v={{ static_version }}">
{% endblock %}

{% block content %}
<div class="flow-editor-page">
    <div class="flow-editor-header">
        <div class="header-left">
            <div class="header-field">
                <label for="workflow-name">ワークフロー名</label>
                <input id="workflow-name" type="text" placeholder="例: hello_world">
            </div>
            <div class="header-field">
                <label for="trigger-type">トリガー</label>
                <select id="trigger-type">
                    <option value="manual">手動実行</option>
                    <option value="schedule">スケジュール実行</option>
                </select>
            </div>
            <div class="header-field">
                <label for="workflow-enabled">状態</label>
                <label class="inline-flex items-center gap-2 text-sm text-gray-600">
                    <input id="workflow-enabled" type="checkbox" class="h-4 w-4">
                    アクティブ
                </label>
            </div>
            <div class="header-field" id="cron-field">
                <label for="trigger-cron">cron</label>
                <input id="trigger-cron" type="text" placeholder="0 9 * * *">
                <label for="cron-preset" class="cron-sub-label">プリセット</label>
                <select id="cron-preset">
                    <option value="">選択してください</option>
                    <option value="*/1 * * * *">毎分</option>
                    <option value="*/5 * * * *">5分ごと</option>
                    <option value="0 * * * *">毎時（毎時00分）</option>
                    <option value="0 9 * * *">毎日 9:00</option>
                    <option value="0 9 * * 1-5">平日 9:00</option>
                    <option value="0 9 * * 0">毎週日曜 9:00</option>
                </select>
                <div id="cron-preview" class="cron-preview"></div>
                <div id="cron-error" class="cron-error"></div>
                <div class="cron-help">
                    形式: 分(0-59) 時(0-23) 日(1-31) 月(1-12) 曜日(0-6/SUN-SAT)
                </div>
                <div class="cron-help">
                    * = すべて / */n = nごと（例: */5 * * * * = 5分ごと） ※タイムゾーンはJST固定
                </div>
            </div>
        </div>
        <div class="header-right">
            <span class="header-status" id="editor-status"></span>
            <button class="primary-button" id="save-workflow">保存</button>
        </div>
    </div>

    {% if error %}
    <div class="flow-editor-error">
        <strong>読み込みエラー:</strong>
        <span>{{ error }}</span>
    </div>
    {% endif %}

    <div class="flow-editor-layout">
        <aside class="flow-panel">
            <div class="panel-title">アクション</div>
            <div id="action-list" class="action-list"></div>
        </aside>

        <section class="flow-canvas-wrap">
            <div class="canvas-toolbar">
                <button class="ghost-button" id="add-node">+ 追加</button>
                <span class="hint">クリックで追加 / ドラッグで移動 / クリックで編集（実行順は上から下）</span>
            </div>
            <div id="flow-canvas" class="flow-canvas"></div>
        </section>

        <aside class="flow-panel">
            <div class="panel-title">詳細</div>
            <div id="inspector" class="inspector"></div>
        </aside>
    </div>
</div>

<script id="flow-editor-config" type="application/json">{{ config_json | safe }}</script>
{% endblock %}

{% block scripts %}
    <script src="/static/flow-editor.js?v={{ static_version }}" defer></script>
{% endblock %}
